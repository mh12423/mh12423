<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA Calculator</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }
        button {
            display: block;
            width: 100%;
            padding: 12px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        button:hover {
            background-color: #45a049;
        }
        .output {
            margin-bottom: 15px;
        }
        .output span {
            font-weight: bold;
        }
    </style>
</head>
<body onload="brython()">
    <h1>RSA Calculator</h1>
    <div class="container">
        <form>
            <label for="message">Enter your message (String):</label>
            <!-- String input -->
            <input type="text" id="message" name="message" required><br>

            <button type="button" id="calculateBtn">Calculate</button>
        </form>
        
        <div id="result">
            <div class="output" id="pOutput"><span>Prime p:</span> </div>
            <div class="output" id="qOutput"><span>Prime q:</span> </div>
            <div class="output" id="eOutput"><span>Public exponent e:</span> </div>
            <div class="output" id="cOutput"><span>Encrypted message:</span> </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">RSA Decryption Calculator</h2>
        <form id="decryptionForm">
            <label for="p">Enter Prime (p):</label>
            <input type="number" id="p" class="rsaInput" placeholder="Prime (p)" required><br>

            <label for="modulus">Enter Prime (q):</label>
            <input type="number" id="q" class="rsaInput" placeholder="Prime (q)" required><br>

            <label for="exponent">Enter Exponent (e):</label>
            <input type="number" id="exponent" class="rsaInput" placeholder="Exponent (e)" required><br>
            
            <label for="ciphertext">Enter Encoded Message (c):</label>
            <input type="number" id="ciphertext" class="rsaInput" placeholder="Ciphertext (c)" required><br>

            <button type="button" id="decryptionCalculateBtn">Decrypt</button>
        </form>

        <div id="decryptionResult" class="output">
            <div class="output" id="dOutput"><span>Decrypted message:</span> </div>
        </div>
    </div>

    <script type="text/python">
        from browser import document, window

        # Function to handle RSA calculation
        def rsa_calculate(event):
            message = document["message"].value
            print(f"Message entered: {message}")
            encrypt = Encrypt(message)
            p, q, e, c = encrypt.encrypt()
            
            # Display results
            document["pOutput"].text = f"Prime p: {p}"
            document["qOutput"].text = f"Prime q: {q}"
            document["eOutput"].text = f"Public exponent e: {e}"
            document["cOutput"].text = f"Encrypted message: {c}"

        # Encrypt class that will handle RSA encryption
        class Encrypt:
            def __init__(self, message):
                self.message = message
                self.keys = self.generate()

            def generate(self):
                def sum_lengths(m):
                    l = 0
                    for i in range(m):
                        l += 25 * (26 ** i)
                    return l
                
                def gcd(a, b):
                    while b:
                        a, b = b, a % b
                    return a
                
                def randint(lower, upper):
                    return int(window.Math.random() * (upper - lower + 1)) + lower

                def generate_coprime(n):
                    candidate = randint(2, n)
                    while gcd(n, candidate) != 1:
                        candidate = randint(2, n)
                    return candidate

                def is_prime(n):
                    if n <= 1:
                        return False
                    if n == 2:
                        return True  # 2 is prime
                    if n % 2 == 0:
                        return False  # Even numbers greater than 2 are not prime
                    for i in range(3, int(window.Math.sqrt(n)) + 1, 2):
                        if n % i == 0:
                            return False
                    return True

                def randprime(lower, upper):
                    while True:
                        candidate = randint(lower, upper)
                        if is_prime(candidate):
                            return candidate

                max_num = sum_lengths(len(self.message))
                p = randprime(1, window.Math.ceil(window.Math.sqrt(max_num)))
                q = randprime(1, window.Math.ceil(window.Math.sqrt(max_num)))
                m = (p - 1) * (q - 1)
                while p == q:
                    q = randprime(1, window.Math.ceil(window.Math.sqrt(max_num)))
                N = p * q
                e = generate_coprime(m)
                return [N, e, p, q]

            def encrypt(self):
                numbers = [(ord(char.lower()) - ord('a') + 1) for char in self.message]
                print(f"Message to numbers: {numbers}")

                def generate_number(numbers):
                    m = 0
                    for i in range(len(numbers)):
                        m += numbers[i] * (26 ** i)
                    print(f"Generated m (message as number): {m}")
                    return m

                N = self.keys[0]
                e = self.keys[1]
                p = self.keys[2]
                q = self.keys[3]
                m = generate_number(numbers)
                c = int(pow(m, e, N))
                return p, q, e, c

        # Set up button event listener
        document["calculateBtn"].bind("click", rsa_calculate)

        def rsa_decrypt(event):
            p = document["p"].value
            print(f"Prime p entered: {p}")
            q = document["q"].value
            print(f"Prime q entered: {q}")
            e = document["e"].value
            print(f"Exponent entered: {e}")
            c = document["c"].value
            print(f"Encoded message entered: {c}")
            decrypt = Decrypt(p, q, e, c)
            decrypted_text = decrypt.decrypt()
            
            # Display results
            document["decryptionResult"].text = f"Decrypted Message: {decrypted_text}"

        class Decrypt:
            def __init__(self, p, q, e, encoded_message):
                self.p = p
                self.q = q
                self.e = e
                self.encoded_message = encoded_message
                self.keys = self.generate()
        
            def generate(self):
                d = pow(self.e, -1, int((self.p-1)*(self.q-1)))
                return d
                
            def decrypt(self):
                N = self.p*self.q
                decoded_number = pow(self.encoded_message, self.keys, N)
                def generate_letters(c):
                    letters_powers = []
                    next_step = c
                    while next_step != 0:
                        remainder = int(next_step%26)
                        next_step = int(math.floor(next_step/26))
                        if remainder == 0:
                            remainder = 26
                            next_step -= 1
                        letters_powers.append(remainder)
                    letters = ''.join([chr(num + 96) for num in letters_powers])
                    return letters
                letters = generate_letters(decoded_number)
                print('d is', self.keys)
                print('The decoded number is', decoded_number)
                print('The decoded message is', letters)
                return letters
        
        document["decryptionCalculateBtn"].bind("click", rsa_decrypt)
    </script>
</body>
</html>
